.gba
.open "ZM_U.gba","ZM_U_locationNames.gba",0x8000000

.definelabel AreaID,0x3000054

; modify code that checks if door displays location name
.org 0x8012534
    bl      FindLocationName
    b       0x8012598

; custom routine to find text number for the door
.org 0x8011ED8
FindLocationName:
    push    r14
    ldr     r0,=AreaID
    ldrb    r2,[r0]     ; r2 = CurrArea
    ldrb    r3,[r0,1]   ; r3 = CurrRoom
    ldr     r1,=LocationNameList
@@Loop:
    ldrb    r0,[r1]     ; r0 = AreaID
    cmp     r0,0xFF
    beq     @@Return
    cmp     r0,r2
    bne     @@Iterate
    ldrb    r0,[r1,1]   ; r0 = RoomID
    cmp     r0,r3
    bne     @@Iterate
    ldrb    r0,[r1,2]   ; r0 = TextNumber
    b       @@Return
@@Iterate:
    add     r1,3
    b       @@Loop
@@Return:
    pop     r1
    bx      r1
    .pool

; door pop-ups from the original rom
LocationNameList:
    ; format: AreaID, RoomID, TextNumber
    .byte 0x00,0x00,0x00
    .byte 0x00,0x08,0x00
    .byte 0x00,0x0B,0x00
    .byte 0x00,0x1A,0x00
    .byte 0x00,0x20,0x0B
    .byte 0x00,0x21,0x00
    .byte 0x00,0x22,0x00

    .byte 0x01,0x00,0x01
    .byte 0x01,0x14,0x09
    .byte 0x01,0x1F,0x09
    .byte 0x01,0x20,0x09
    .byte 0x01,0x23,0x0B
    .byte 0x01,0x24,0x09
    .byte 0x01,0x27,0x09

    .byte 0x02,0x00,0x02
    .byte 0x02,0x02,0x02
    .byte 0x02,0x23,0x02
    .byte 0x02,0x24,0x09
    .byte 0x02,0x27,0x09
    .byte 0x02,0x28,0x0B
    .byte 0x02,0x29,0x09
    .byte 0x02,0x2B,0x02
    .byte 0x02,0x2C,0x09
    .byte 0x02,0x2D,0x09

    .byte 0x03,0x00,0x03
    .byte 0x03,0x01,0x09
    .byte 0x03,0x02,0x03
    .byte 0x03,0x14,0x09
    .byte 0x03,0x15,0x0B
    .byte 0x03,0x18,0x09
    .byte 0x03,0x19,0x09

    .byte 0x04,0x00,0x04
    .byte 0x04,0x05,0x04
    .byte 0x04,0x06,0x09
    .byte 0x04,0x08,0x04
    .byte 0x04,0x0B,0x09
    .byte 0x04,0x14,0x09

    .byte 0x05,0x00,0x08
    .byte 0x05,0x03,0x05
    .byte 0x05,0x04,0x05
    .byte 0x05,0x06,0x05
    .byte 0x05,0x08,0x0C
    .byte 0x05,0x09,0x0C
    .byte 0x05,0x0A,0x05
    .byte 0x05,0x0B,0x05
    .byte 0x05,0x0C,0x05
    .byte 0x05,0x0D,0x05
    .byte 0x05,0x0F,0x0C
    .byte 0x05,0x10,0x0C
    .byte 0x05,0x11,0x0C
    .byte 0x05,0x12,0x05

    .byte 0x06,0x00,0x06
    .byte 0x06,0x0A,0x07
    .byte 0x06,0x14,0x07
    .byte 0x06,0x19,0x0C
    .byte 0x06,0x22,0x06
    .byte 0x06,0x32,0x07
    .byte 0x06,0x39,0x0C
    .byte 0x06,0x43,0x0C
    .byte 0x06,0x44,0x06
    .byte 0x06,0x4E,0x07
    .byte 0x06,0x5D,0x07

    .byte 0xFF,0xFF,0xFF


.close
